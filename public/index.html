<!DOCTYPE html>
<html lang="en">

<head>
    <title> Pendle College Welcome Week </title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Pendle College welcome week website">

    <!-- Custom stylesheet -->
    <link href="css/style.css" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <script>
        function displayTimetable() {
            getJSON(function(jsonText) {
                var timetableJSON = JSON.parse(jsonText);
                var events = timetableJSON.timetable.events;
                var numEvents =  Object.keys(events).length;
                createTimetableCards(numEvents);
                var timetableDiv = document.getElementById("timetable");
                var rows = timetableDiv.children;
                var i = 0;
                for (var row of rows) {
                    var cards = row.children;
                    for (var card of cards) {
                        var body = card.firstChild;
                        var title = body.getElementsByTagName("h5")[0];
                        title.textContent = events[i].name;
                        var date = body.getElementsByTagName("p")[0];
                        date.textContent = `Date: ${events[i].date} (${events[i].time}) `;
                        var description = body.getElementsByTagName("p")[1];
                        description.textContent = events[i].description;
                        i++;
                    }
                }
            })            
        }

        function getJSON(cb) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    cb(this.responseText);
                }
            }
            xmlhttp.open("GET", "/data/timetable.json?r="+Math.random());
            xmlhttp.send();
        }

        function createTimetableCards(numCards) {
            var numRows = Math.ceil(numCards / 6);
            var timetableDiv = document.getElementById("timetable");
            var row = document.createElement("div");
            row.className = "d-flex flex-wrap";
            for (let i = 0; i < numRows; i++) {
                //timetableDiv.appendChild(newDiv);
                for (let j = 0; j < 6 && numCards > 0; j++) {
                    var newCard = createCard();
                    row.appendChild(newCard);
                    numCards--;
                }
            }
            timetableDiv.appendChild(row);
        }
        function createCard() {
            var newCard = document.createElement("div");
            newCard.className = "card m-3";
            newCard.style = "width: 18rem; border: 3px solid DarkGreen;";
            var cardBody = document.createElement("div");
            cardBody.className = "card-body d-flex flex-column";
            var cardTitle = document.createElement("h5");
            cardTitle.className = "card-title";
            cardTitle.textContent = "Title";
            cardTitle.style = "text-align: center";
            var cardDate = document.createElement("p");
            cardDate.className = "card-text";
            cardDate.textContent = "some date";
            var cardText = document.createElement("p");
            cardText.className = "card-text";
            cardText.textContent = "some text";
            cardText.style = "flex-grow: 1;";
            var cardButton = document.createElement("a");
            cardButton.className = "btn";
            cardButton.textContent = "See more...";
            cardButton.style = "background-color: rgba(0, 100, 0); color: rgba(255, 255, 255);"

            cardBody.appendChild(cardTitle);
            cardBody.appendChild(cardDate);
            cardBody.appendChild(cardText);
            cardBody.appendChild(cardButton);
            newCard.appendChild(cardBody);

            return newCard;
        }

        function filterEvents() {
            var selectedDay = document.getElementById("days").value;
            var timetableRow = document.getElementById("timetable").children[0];
            for (card of timetableRow.children) {
                var date = card.children[0].children[1].textContent;
                if (!date.includes(selectedDay) && selectedDay != "none") {
                    card.style["display"] = "none";
                } else {
                    card.style["display"] = "";
                }
            }
        }
    </script>

</head>

<body onload="displayTimetable()">
    <div>
        <!-- Header -->
        <!-- Pendle logo -->
        <img src="img/pendle-college-logo.svg" alt="Pendle College logo" class="logo">
    </div>

    <div class="d-flex flex-row nav-bar">
        <!-- Nav bar -->
        <a href="#">
            <div class="p-2 nav-item-selected">Welcome Week Schedule</div>
        </a>
        <a href="jcr.html">
            <div class="p-2">Meet the JCR</div>
        </a>
        <a href="#">
            <div class="p-2">Sports</div>
        </a>
        <a href="#">
            <div class="p-2">FAQs and Tips</div>
        </a>
      </div>

    <div>
        <!-- Main body -->
        <div class="p-4 flex-row" id="controls">
            <label for="days">Filter by day: </label>
            <select id="days" onchange="filterEvents()">
                <option value="none" selected> Select a day </option>
                <option value="Saturday 2nd October">Saturday 2nd October</option>
                <option value="Sunday 3rd October">Sunday 3rd October</option>
                <option value="Monday 4th October">Monday 4th October</option>
                <option value="Tuesday 5th October">Tuesday 5th October</option>
                <option value="Wednesday 6th October">Wednesday 6th October</option>
                <option value="Thursday 7th October">Thursday 7th October</option>
                <option value="Friday 8th October">Friday 8th October</option>
                <option value="Saturday 9th October">Saturday 9th October</option>
                <option value="Sunday 10th October">Sunday 10th October</option>
            </select>
        </div>
        <div id="timetable"\>
    </div>

    <!-- More bootstrap -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <!-- Firebase -->
    <script src="/__/firebase/8.9.1/firebase-app.js"></script>
    <script src="/__/firebase/8.9.1/firebase-analytics.js"></script>
    <script src="/__/firebase/init.js"></script>

</body>

</html>
